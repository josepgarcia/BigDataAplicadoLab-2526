.PHONY: build help up down restart logs clean deep-clean deep-clean-force status test hive-beeline hive-query hive-script download-cache

help:
	@echo "InformaciÃ³n de todas las opciones"

# Descargar Hadoop y Hive al cachÃ© local (acelera reconstrucciones)
download-cache:
	@echo "ğŸ“¦ Descargando archivos al cachÃ© local..."
	@cd Base && ./download-cache.sh

# Construir las imÃ¡genes
build:
	@echo "ğŸ”¨ Construyendo imÃ¡genes Docker..."
	docker-compose build

# Levantar el clÃºster
up:
	@echo "ğŸš€ Levantando clÃºster Hadoop (2 nodos)..."
	docker-compose up -d
	@echo "â³ Esperando a que los servicios estÃ©n listos..."
	@sleep 20
	@echo "âœ… ClÃºster levantado!"
	@echo "ğŸ“Š NameNode UI: http://localhost:9870"
	@echo "ğŸ“Š ResourceManager UI: http://localhost:8088"

clean:
	@echo "ğŸ§¹ Limpiando contenedores, volÃºmenes y red del proyecto..."
	docker-compose down -v
	@echo "âœ… Limpieza completada!"
	@echo "ğŸ’¡ Para eliminar tambiÃ©n las imÃ¡genes usa: make deep-clean"


# Limpieza profunda: elimina ABSOLUTAMENTE TODO (contenedores, volÃºmenes, imÃ¡genes, red y cachÃ©)
deep-clean:
	@echo "ğŸ”¥ LIMPIEZA PROFUNDA - Eliminando recursos del proyecto..."
	@echo "âš ï¸  Esto eliminarÃ¡:"
	@echo "   - Contenedores del clÃºster Hadoop (master, slave1)"
	@echo "   - VolÃºmenes de datos del proyecto"
	@echo "   - ImÃ¡genes Docker del proyecto (modulo1-*)"
	@echo "   - Red del clÃºster"
	@echo "   - CachÃ© de build del proyecto"
	@echo ""
	@read -p "Â¿EstÃ¡s seguro? (s/N): " confirm && [ "$$confirm" = "s" ] || [ "$$confirm" = "S" ] || (echo "OperaciÃ³n cancelada" && exit 1)
	@echo ""
	@echo "ğŸ—‘ï¸  Deteniendo y eliminando contenedores y volÃºmenes del proyecto..."
	@docker-compose down -v 2>/dev/null || true
	@echo "ğŸ—‘ï¸  Eliminando imÃ¡genes del proyecto..."
	@docker rmi modulo1-master modulo1-slave1 2>/dev/null || true
	@echo "ğŸ—‘ï¸  Eliminando volÃºmenes del proyecto..."
	@docker volume rm modulo1_master-data modulo1_slave1-data 2>/dev/null || true
	@echo "ğŸ—‘ï¸  Eliminando red del proyecto..."
	@docker network rm modulo1_hadoop-net 2>/dev/null || true
	@echo "ğŸ—‘ï¸  Limpiando cachÃ© de build (solo capas no utilizadas)..."
	@docker build

# Acceder al shell del master
shell-master:
	docker exec -it hadoop-master bash

# Acceder al shell de slave1
shell-slave1:
	docker exec -it hadoop-slave1 bash
